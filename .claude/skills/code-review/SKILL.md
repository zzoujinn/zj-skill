---
name: code-review
description: 代码审查，检查质量、安全性、性能和最佳实践。当用户要求审查代码、检查bug、分析代码质量或提供代码反馈时使用。触发条件包括："review this code"、"code review"、"check for bugs"、"analyze this code"、"code feedback"、"code quality check"、"security review"、"performance review"，或任何检查代码问题或改进的请求。
---

# 代码审查

## 审查框架

使用以下检查清单进行全面的代码审查：

### 1. 正确性与 Bug
- 代码是否实现了预期功能？
- 是否存在差一错误、空指针问题或边界情况问题？
- 错误处理是否恰当和完整？

### 2. 安全性
- 用户输入是否经过适当的验证和清理？
- 是否存在 SQL 注入、XSS 或其他安全漏洞？
- 敏感数据（密码、API 密钥、令牌）是否得到妥善处理？
- 身份验证和授权检查是否正确？

### 3. 性能
- 是否有不必要的循环、冗余计算或低效算法？
- 时间复杂度是否适合该问题？
- 是否有缓存或记忆化的机会？
- 数据库查询是否优化（避免 N+1 查询，使用索引）？

### 4. 代码质量与可读性
- 变量和函数名称是否具有描述性且一致？
- 代码结构是否逻辑清晰且易于理解？
- 复杂逻辑是否有适当的注释？
- 代码是否遵循 DRY（不要重复自己）原则，或是否存在重复模式？

### 5. 最佳实践与模式
- 是否遵循了语言/框架的最佳实践？
- 设计模式是否使用得当？
- 代码是否遵循 SOLID 原则？
- 是否存在代码异味（长函数、大类、上帝对象）？

### 6. 测试
- 代码是否可测试？
- 是否有应该测试的边界情况？
- 测试是否需要使用 mock 或 stub？

## 审查格式

按以下结构组织您的审查：

```markdown
## 代码审查摘要

### 整体评估
[高层摘要：做得好的地方、主要关注点]

### 发现的问题

#### 严重
- [问题描述及行号参考]

#### 重要
- [问题描述及行号参考]

#### 建议
- [改进建议]

### 优点
- [做得好的地方]

### 建议行动
1. [优先行动]
2. [次要行动]
```

## 语言特定指南

### Python
- 遵循 PEP 8 风格指南
- 为函数签名使用类型提示
- 优先使用列表推导式而非 map/filter
- 使用上下文管理器（with 语句）处理资源
- 恰当使用 `is None` 与 `== None`

### JavaScript/TypeScript
- 使用 const/let，避免 var
- 对 promise 使用 async/await
- 优先对回调使用箭头函数
- 使用 === 和 !== 而非 == 和 !=

### Java
- 遵循 Java 命名约定
- 适当情况下优先使用接口而非抽象类
- 使用 try-with-resources 管理资源
- 尽可能考虑不可变性

## 安全检查清单

- [ ] 所有用户输入的验证
- [ ] SQL 查询使用参数化语句或 ORM
- [ ] 输出编码以防止 XSS
- [ ] 敏感端点的身份验证/授权检查
- [ ] 无硬编码的密钥或凭据
- [ ] 恰当的错误消息（不泄露敏感信息）
- [ ] 状态更改操作的 CSRF 保护
